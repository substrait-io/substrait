# select
#   s.s_acctbal,
#   s.s_name,
#   n.n_name,
#   p.p_partkey,
#   p.p_mfgr,
#   s.s_address,
#   s.s_phone,
#   s.s_comment
# from
#   "part" p,
#   "supplier" s,
#   "partsupp" ps,
#   "nation" n,
#   "region" r
# where
#   p.p_partkey = ps.ps_partkey
#   and s.s_suppkey = ps.ps_suppkey
#   and p.p_size = 41
#   and p.p_type like '%NICKEL'
#   and s.s_nationkey = n.n_nationkey
#   and n.n_regionkey = r.r_regionkey
#   and r.r_name = 'EUROPE'
#   and ps.ps_supplycost = (
#
#     select
#       min(ps.ps_supplycost)
#
#     from
#       "partsupp" ps,
#       "supplier" s,
#       "nation" n,
#       "region" r
#     where
#       p.p_partkey = ps.ps_partkey
#       and s.s_suppkey = ps.ps_suppkey
#       and s.s_nationkey = n.n_nationkey
#       and n.n_regionkey = r.r_regionkey
#       and r.r_name = 'EUROPE'
#   )
#
# order by
#   s.s_acctbal desc,
#   n.n_name,
#   s.s_name,
#   p.p_partkey
# limit 100

name: TPC-H02
diags:
- { code: 0001, max: i } # Suppress "not yet implemented" warnings
- { code: 3002, max: i } # Suppress function name resolution errors (function parsing isn't implemented yet)
- { code: 6003, max: i } # Suppress function definition check warnings (function parsing isn't implemented yet)
plan:
  __test:
  - level: i
  extensionUris:
  - extensionUriAnchor: 1
    uri: /functions_boolean.yaml
  - extensionUriAnchor: 2
    uri: /functions_comparison.yaml
  - extensionUriAnchor: 3
    uri: /functions_string.yaml
  - extensionUriAnchor: 4
    uri: /functions_aggregate_generic.yaml
  extensions:
  - extensionFunction:
      extensionUriReference: 1
      functionAnchor: 1
      name: and:bool
  - extensionFunction:
      extensionUriReference: 2
      functionAnchor: 2
      name: equal:any_any
  - extensionFunction:
      extensionUriReference: 3
      functionAnchor: 3
      name: like:vchar_vchar
  - extensionFunction:
      extensionUriReference: 4
      functionAnchor: 4
      name: min:any_any
  relations:
  - root:
      input:
        fetch:
          common:
            direct: {}
          count: '100'
          input:
            sort:
              common:
                direct: {}
              input:
                project:
                  common:
                    emit:
                      outputMapping:
                      - 28
                      - 29
                      - 30
                      - 31
                      - 32
                      - 33
                      - 34
                      - 35
                  expressions:
                  - selection:
                      directReference:
                        structField:
                          field: 14
                      rootReference: {}
                  - selection:
                      directReference:
                        structField:
                          field: 10
                      rootReference: {}
                  - selection:
                      directReference:
                        structField:
                          field: 22
                      rootReference: {}
                  - selection:
                      directReference:
                        structField: {}
                      rootReference: {}
                  - selection:
                      directReference:
                        structField:
                          field: 2
                      rootReference: {}
                  - selection:
                      directReference:
                        structField:
                          field: 11
                      rootReference: {}
                  - selection:
                      directReference:
                        structField:
                          field: 13
                      rootReference: {}
                  - selection:
                      directReference:
                        structField:
                          field: 15
                      rootReference: {}
                  input:
                    filter:
                      common:
                        direct: {}
                      condition:
                        scalarFunction:
                          args:
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField: {}
                                  rootReference: {}
                              - selection:
                                  directReference:
                                    structField:
                                      field: 16
                                  rootReference: {}
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_REQUIRED
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField:
                                      field: 9
                                  rootReference: {}
                              - selection:
                                  directReference:
                                    structField:
                                      field: 17
                                  rootReference: {}
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_REQUIRED
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField:
                                      field: 5
                                  rootReference: {}
                              - literal:
                                  i32: 41
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_NULLABLE
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField:
                                      field: 4
                                  rootReference: {}
                              - cast:
                                  input:
                                    literal:
                                      fixedChar: '%NICKEL'
                                  type:
                                    varchar:
                                      length: 25
                                      nullability: NULLABILITY_NULLABLE
                              functionReference: 3
                              outputType:
                                bool:
                                  nullability: NULLABILITY_NULLABLE
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField:
                                      field: 12
                                  rootReference: {}
                              - selection:
                                  directReference:
                                    structField:
                                      field: 21
                                  rootReference: {}
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_REQUIRED
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField:
                                      field: 23
                                  rootReference: {}
                              - selection:
                                  directReference:
                                    structField:
                                      field: 25
                                  rootReference: {}
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_REQUIRED
                          - scalarFunction:
                              args:
                              - selection:
                                  directReference:
                                    structField:
                                      field: 26
                                  rootReference: {}
                              - cast:
                                  input:
                                    literal:
                                      fixedChar: EUROPE
                                  type:
                                    fixedChar:
                                      length: 25
                                      nullability: NULLABILITY_REQUIRED
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_NULLABLE
                          - scalarFunction:
                              args:
                              - subquery:
                                  scalar:
                                    input:
                                      aggregate:
                                        common:
                                          emit:
                                            outputMapping:
                                            - 0
                                        input:
                                          project:
                                            common:
                                              emit:
                                                outputMapping:
                                                - 19
                                            expressions:
                                            - selection:
                                                directReference:
                                                  structField:
                                                    field: 3
                                                rootReference: {}
                                            input:
                                              filter:
                                                common:
                                                  direct: {}
                                                condition:
                                                  scalarFunction:
                                                    args:
                                                    - scalarFunction:
                                                        args:
                                                        - selection:
                                                            directReference:
                                                              structField: {}
                                                            outerReference:
                                                              stepsOut: 1
                                                        - selection:
                                                            directReference:
                                                              structField: {}
                                                            rootReference: {}
                                                        functionReference: 2
                                                        outputType:
                                                          bool:
                                                            nullability: NULLABILITY_REQUIRED
                                                    - scalarFunction:
                                                        args:
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 5
                                                            rootReference: {}
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 1
                                                            rootReference: {}
                                                        functionReference: 2
                                                        outputType:
                                                          bool:
                                                            nullability: NULLABILITY_REQUIRED
                                                    - scalarFunction:
                                                        args:
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 8
                                                            rootReference: {}
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 12
                                                            rootReference: {}
                                                        functionReference: 2
                                                        outputType:
                                                          bool:
                                                            nullability: NULLABILITY_REQUIRED
                                                    - scalarFunction:
                                                        args:
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 14
                                                            rootReference: {}
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 16
                                                            rootReference: {}
                                                        functionReference: 2
                                                        outputType:
                                                          bool:
                                                            nullability: NULLABILITY_REQUIRED
                                                    - scalarFunction:
                                                        args:
                                                        - selection:
                                                            directReference:
                                                              structField:
                                                                field: 17
                                                            rootReference: {}
                                                        - cast:
                                                            input:
                                                              literal:
                                                                fixedChar: EUROPE
                                                            type:
                                                              fixedChar:
                                                                length: 25
                                                                nullability: NULLABILITY_REQUIRED
                                                        functionReference: 2
                                                        outputType:
                                                          bool:
                                                            nullability: NULLABILITY_NULLABLE
                                                    functionReference: 1
                                                    outputType:
                                                      bool:
                                                        nullability: NULLABILITY_NULLABLE
                                                input:
                                                  join:
                                                    common:
                                                      direct: {}
                                                    expression:
                                                      literal:
                                                        boolean: true
                                                    left:
                                                      join:
                                                        common:
                                                          direct: {}
                                                        expression:
                                                          literal:
                                                            boolean: true
                                                        left:
                                                          join:
                                                            common:
                                                              direct: {}
                                                            expression:
                                                              literal:
                                                                boolean: true
                                                            left:
                                                              read:
                                                                baseSchema:
                                                                  names:
                                                                  - PS_PARTKEY
                                                                  - PS_SUPPKEY
                                                                  - PS_AVAILQTY
                                                                  - PS_SUPPLYCOST
                                                                  - PS_COMMENT
                                                                  struct:
                                                                    nullability: NULLABILITY_REQUIRED
                                                                    types:
                                                                    - i64:
                                                                        nullability: NULLABILITY_REQUIRED
                                                                    - i64:
                                                                        nullability: NULLABILITY_REQUIRED
                                                                    - i32:
                                                                        nullability: NULLABILITY_NULLABLE
                                                                    - decimal:
                                                                        nullability: NULLABILITY_NULLABLE
                                                                        precision: 19
                                                                    - varchar:
                                                                        length: 199
                                                                        nullability: NULLABILITY_NULLABLE
                                                                common:
                                                                  direct: {}
                                                                namedTable:
                                                                  names:
                                                                  - PARTSUPP
                                                            right:
                                                              read:
                                                                baseSchema:
                                                                  names:
                                                                  - S_SUPPKEY
                                                                  - S_NAME
                                                                  - S_ADDRESS
                                                                  - S_NATIONKEY
                                                                  - S_PHONE
                                                                  - S_ACCTBAL
                                                                  - S_COMMENT
                                                                  struct:
                                                                    nullability: NULLABILITY_REQUIRED
                                                                    types:
                                                                    - i64:
                                                                        nullability: NULLABILITY_REQUIRED
                                                                    - fixedChar:
                                                                        length: 25
                                                                        nullability: NULLABILITY_NULLABLE
                                                                    - varchar:
                                                                        length: 40
                                                                        nullability: NULLABILITY_NULLABLE
                                                                    - i64:
                                                                        nullability: NULLABILITY_REQUIRED
                                                                    - fixedChar:
                                                                        length: 15
                                                                        nullability: NULLABILITY_NULLABLE
                                                                    - decimal:
                                                                        nullability: NULLABILITY_NULLABLE
                                                                        precision: 19
                                                                    - varchar:
                                                                        length: 101
                                                                        nullability: NULLABILITY_NULLABLE
                                                                common:
                                                                  direct: {}
                                                                namedTable:
                                                                  names:
                                                                  - SUPPLIER
                                                            type: JOIN_TYPE_INNER
                                                        right:
                                                          read:
                                                            baseSchema:
                                                              names:
                                                              - N_NATIONKEY
                                                              - N_NAME
                                                              - N_REGIONKEY
                                                              - N_COMMENT
                                                              struct:
                                                                nullability: NULLABILITY_REQUIRED
                                                                types:
                                                                - i64:
                                                                    nullability: NULLABILITY_REQUIRED
                                                                - fixedChar:
                                                                    length: 25
                                                                    nullability: NULLABILITY_NULLABLE
                                                                - i64:
                                                                    nullability: NULLABILITY_REQUIRED
                                                                - varchar:
                                                                    length: 152
                                                                    nullability: NULLABILITY_NULLABLE
                                                            common:
                                                              direct: {}
                                                            namedTable:
                                                              names:
                                                              - NATION
                                                        type: JOIN_TYPE_INNER
                                                    right:
                                                      read:
                                                        baseSchema:
                                                          names:
                                                          - R_REGIONKEY
                                                          - R_NAME
                                                          - R_COMMENT
                                                          struct:
                                                            nullability: NULLABILITY_REQUIRED
                                                            types:
                                                            - i64:
                                                                nullability: NULLABILITY_REQUIRED
                                                            - fixedChar:
                                                                length: 25
                                                                nullability: NULLABILITY_NULLABLE
                                                            - varchar:
                                                                length: 152
                                                                nullability: NULLABILITY_NULLABLE
                                                        common:
                                                          direct: {}
                                                        namedTable:
                                                          names:
                                                          - REGION
                                                    type: JOIN_TYPE_INNER
                                        measures:
                                        - measure:
                                            args:
                                            - selection:
                                                directReference:
                                                  structField:
                                                    field: 0
                                                rootReference: {}
                                            functionReference: 4
                                            outputType:
                                              decimal:
                                                nullability: NULLABILITY_NULLABLE
                                                precision: 19
                                            phase: AGGREGATION_PHASE_INITIAL_TO_RESULT
                              - selection:
                                  directReference:
                                    structField:
                                      field: 19
                                  rootReference: {}
                              functionReference: 2
                              outputType:
                                bool:
                                  nullability: NULLABILITY_NULLABLE
                          functionReference: 1
                          outputType:
                            bool:
                              nullability: NULLABILITY_NULLABLE
                      input:
                        join:
                          common:
                            direct: {}
                          expression:
                            literal:
                              boolean: true
                          left:
                            join:
                              common:
                                direct: {}
                              expression:
                                literal:
                                  boolean: true
                              left:
                                join:
                                  common:
                                    direct: {}
                                  expression:
                                    literal:
                                      boolean: true
                                  left:
                                    join:
                                      common:
                                        direct: {}
                                      expression:
                                        literal:
                                          boolean: true
                                      left:
                                        read:
                                          baseSchema:
                                            names:
                                            - P_PARTKEY
                                            - P_NAME
                                            - P_MFGR
                                            - P_BRAND
                                            - P_TYPE
                                            - P_SIZE
                                            - P_CONTAINER
                                            - P_RETAILPRICE
                                            - P_COMMENT
                                            struct:
                                              nullability: NULLABILITY_REQUIRED
                                              types:
                                              - i64:
                                                  nullability: NULLABILITY_REQUIRED
                                              - varchar:
                                                  length: 55
                                                  nullability: NULLABILITY_NULLABLE
                                              - fixedChar:
                                                  length: 25
                                                  nullability: NULLABILITY_NULLABLE
                                              - fixedChar:
                                                  length: 10
                                                  nullability: NULLABILITY_NULLABLE
                                              - varchar:
                                                  length: 25
                                                  nullability: NULLABILITY_NULLABLE
                                              - i32:
                                                  nullability: NULLABILITY_NULLABLE
                                              - fixedChar:
                                                  length: 10
                                                  nullability: NULLABILITY_NULLABLE
                                              - decimal:
                                                  nullability: NULLABILITY_NULLABLE
                                                  precision: 19
                                              - varchar:
                                                  length: 23
                                                  nullability: NULLABILITY_NULLABLE
                                          common:
                                            direct: {}
                                          namedTable:
                                            names:
                                            - PART
                                      right:
                                        read:
                                          baseSchema:
                                            names:
                                            - S_SUPPKEY
                                            - S_NAME
                                            - S_ADDRESS
                                            - S_NATIONKEY
                                            - S_PHONE
                                            - S_ACCTBAL
                                            - S_COMMENT
                                            struct:
                                              nullability: NULLABILITY_REQUIRED
                                              types:
                                              - i64:
                                                  nullability: NULLABILITY_REQUIRED
                                              - fixedChar:
                                                  length: 25
                                                  nullability: NULLABILITY_NULLABLE
                                              - varchar:
                                                  length: 40
                                                  nullability: NULLABILITY_NULLABLE
                                              - i64:
                                                  nullability: NULLABILITY_REQUIRED
                                              - fixedChar:
                                                  length: 15
                                                  nullability: NULLABILITY_NULLABLE
                                              - decimal:
                                                  nullability: NULLABILITY_NULLABLE
                                                  precision: 19
                                              - varchar:
                                                  length: 101
                                                  nullability: NULLABILITY_NULLABLE
                                          common:
                                            direct: {}
                                          namedTable:
                                            names:
                                            - SUPPLIER
                                      type: JOIN_TYPE_INNER
                                  right:
                                    read:
                                      baseSchema:
                                        names:
                                        - PS_PARTKEY
                                        - PS_SUPPKEY
                                        - PS_AVAILQTY
                                        - PS_SUPPLYCOST
                                        - PS_COMMENT
                                        struct:
                                          nullability: NULLABILITY_REQUIRED
                                          types:
                                          - i64:
                                              nullability: NULLABILITY_REQUIRED
                                          - i64:
                                              nullability: NULLABILITY_REQUIRED
                                          - i32:
                                              nullability: NULLABILITY_NULLABLE
                                          - decimal:
                                              nullability: NULLABILITY_NULLABLE
                                              precision: 19
                                          - varchar:
                                              length: 199
                                              nullability: NULLABILITY_NULLABLE
                                      common:
                                        direct: {}
                                      namedTable:
                                        names:
                                        - PARTSUPP
                                  type: JOIN_TYPE_INNER
                              right:
                                read:
                                  baseSchema:
                                    names:
                                    - N_NATIONKEY
                                    - N_NAME
                                    - N_REGIONKEY
                                    - N_COMMENT
                                    struct:
                                      nullability: NULLABILITY_REQUIRED
                                      types:
                                      - i64:
                                          nullability: NULLABILITY_REQUIRED
                                      - fixedChar:
                                          length: 25
                                          nullability: NULLABILITY_NULLABLE
                                      - i64:
                                          nullability: NULLABILITY_REQUIRED
                                      - varchar:
                                          length: 152
                                          nullability: NULLABILITY_NULLABLE
                                  common:
                                    direct: {}
                                  namedTable:
                                    names:
                                    - NATION
                              type: JOIN_TYPE_INNER
                          right:
                            read:
                              baseSchema:
                                names:
                                - R_REGIONKEY
                                - R_NAME
                                - R_COMMENT
                                struct:
                                  nullability: NULLABILITY_REQUIRED
                                  types:
                                  - i64:
                                      nullability: NULLABILITY_REQUIRED
                                  - fixedChar:
                                      length: 25
                                      nullability: NULLABILITY_NULLABLE
                                  - varchar:
                                      length: 152
                                      nullability: NULLABILITY_NULLABLE
                              common:
                                direct: {}
                              namedTable:
                                names:
                                - REGION
                          type: JOIN_TYPE_INNER
              sorts:
              - direction: SORT_DIRECTION_DESC_NULLS_FIRST
                expr:
                  selection:
                    directReference:
                      structField: {}
                    rootReference: {}
              - direction: SORT_DIRECTION_ASC_NULLS_LAST
                expr:
                  selection:
                    directReference:
                      structField:
                        field: 2
                    rootReference: {}
              - direction: SORT_DIRECTION_ASC_NULLS_LAST
                expr:
                  selection:
                    directReference:
                      structField:
                        field: 1
                    rootReference: {}
              - direction: SORT_DIRECTION_ASC_NULLS_LAST
                expr:
                  selection:
                    directReference:
                      structField:
                        field: 3
                    rootReference: {}
      names:
      - S_ACCTBAL
      - S_NAME
      - N_NAME
      - P_PARTKEY
      - P_MFGR
      - S_ADDRESS
      - S_PHONE
      - S_COMMENT
